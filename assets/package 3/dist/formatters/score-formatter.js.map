{"version":3,"sources":["../../src/formatters/score-formatter.js"],"names":["ScoreFormatter","Formatter","constructor","options","eventBroadcaster","checkNew","on","handleTestRunFinished","table","Table","head","colAligns","style","chars","top","bottom","left","mid","right","middle","totalPoints","totalEarned","getScenarios","eventDataCollector","name","status","tags","points","getPointValue","earned","Status","PASSED","color","colorFns","indicator","statusCharacters","push","bold","log","toString","pointRegexp","tag","matches","exec","testCaseMap","pickleMap","key","hasOwnProperty","result"],"mappings":"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","file":"score-formatter.js","sourcesContent":["import { Formatter, Status } from 'cucumber';\nimport Table from 'cli-table';\nimport { statusCharacters } from './characters';\n\nexport default class ScoreFormatter extends Formatter {\n  constructor(options) {\n    super(options);\n    const { eventBroadcaster } = options;\n    this.checkNew = options.checkNew;\n\n    eventBroadcaster.on('test-run-finished', () => this.handleTestRunFinished());\n  }\n  handleTestRunFinished() {\n    const table = new Table({\n      head: [ 'Scenario', 'Points', 'Earned' ],\n      colAligns: [ 'left', 'right', 'right' ],\n      style: {\n        head: [ 'bold', 'blue', 'inverse' ],\n      },\n      chars: {\n        top: '─', 'top-mid': '─', 'top-left': '┌', 'top-right': '┐',\n        bottom: '─', 'bottom-mid': '─', 'bottom-left': '└', 'bottom-right': '┘',\n        left: '│', 'left-mid': '', mid: '', 'mid-mid': '',\n        right: '│', 'right-mid': '', middle: ' ',\n      },\n    });\n\n    let totalPoints = 0;\n    let totalEarned = 0;\n\n    for (const { name, status, tags } of getScenarios(this.eventDataCollector)) {\n      const points = getPointValue(tags);\n      const earned = status === Status.PASSED ? points : 0;\n\n      totalPoints += points;\n      totalEarned += earned;\n\n      const color = this.colorFns[status];\n      const indicator = statusCharacters[status];\n\n      table.push([ `${color(indicator)} ${name}`, points, color(earned) ]);\n    }\n\n    table.push([ '', '══════', '══════' ], [\n      this.colorFns.bold('TOTAL'),\n      this.colorFns.bold(totalPoints),\n      this.colorFns.bold(totalEarned),\n    ]);\n\n    this.log(`${table.toString()}\\n\\n`);\n\n    this.log(`FS_SCORE:${totalEarned}%\\n`);\n  }\n}\n\nconst pointRegexp = /^@points=(\\d{1,2})$/;\n\nfunction getPointValue(tags) {\n  for (const tag of tags) {\n    const matches = pointRegexp.exec(tag.name);\n    if (matches)\n      return +matches[1];\n  }\n\n  return 0;\n}\n\nfunction* getScenarios({ testCaseMap, pickleMap }) {\n  for (const key in testCaseMap) {\n    if (!testCaseMap.hasOwnProperty(key)) continue;\n\n    const { name, tags } = pickleMap[key];\n    const { result: { status } } = testCaseMap[key];\n\n    yield { name, tags, status };\n  }\n}\n"]}